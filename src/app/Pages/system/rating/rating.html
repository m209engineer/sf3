<app-navbar></app-navbar>
<div class="rating-container" [class.dark-mode]="isDarkMode">
  <div class="rating-header">
    <h2>Reyting</h2>
    <div class="controls">
      <div class="sort-container">
        <div class="sort-buttons">
          <button *ngFor="let option of sortOptions" 
                  [class.active]="selectedSort === option.value"
                  (click)="onSortChange(option.value)"
                  [title]="option.label">
            {{ isMobile ? getShortLabel(option.label) : option.label }}
          </button>
        </div>
        <div class="month-selector">
          <label>Oy tanlang:</label>
          <select (change)="onMonthChange($event)">
            <option value="" [selected]="!selectedMonth">Umumiy</option>
            <option *ngFor="let month of availableMonths" [value]="month" [selected]="month === selectedMonth">
              {{ month }}
            </option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <div class="table-container">
    <div class="month-title" *ngIf="selectedMonth">
      <span>{{ selectedMonth }} oyi bo'yicha</span>
      <button class="reset-button" (click)="resetMonth()">Bekor qilish</button>
    </div>
    <table class="ranking-table">
      <thead>
        <tr>
          <th class="rank-col">#</th>
          <th class="student-col">Talaba</th>
          <th class="stat-col1" *ngIf="selectedSort === 'total' || selectedSort === 'davomat'">{{ isMobile ? 'Davomat' : 'Davomat' }}</th>
          <th class="stat-col1" *ngIf="selectedSort === 'total' || selectedSort === 'uy_vazifa'">{{ isMobile ? 'Uy vaz.' : 'Uy vazifa' }}</th>
          <th class="stat-col1" *ngIf="selectedSort === 'total' || selectedSort === 'tasks'">{{ isMobile ? 'Topsh.' : 'Topshiriq' }}</th>
          <th class="stat-col1" *ngIf="selectedSort === 'total' || selectedSort === 'jarima'">{{ isMobile ? 'Jarima' : 'Jarima' }}</th>
          <th class="total-col1" *ngIf="selectedSort === 'total'">XP</th>
          <th class="level-col1">Daraja</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of ranking" [class.current-student]="item.student.id === currentStudent?.id">
          <td class="rank-col">
            <span class="rank-badge">{{ item.rank }}</span>
          </td>
          <td class="student-col">
            <div class="student-info">
              <img [src]="item.student.image" alt="Avatar" class="avatar">
              <span class="student-name">{{ item.student.name }}</span>
            </div>
          </td>
          <td class="stat-col" *ngIf="selectedSort === 'total' || selectedSort === 'davomat'">
            {{ getTotal(item.student, 'davomat') }}
          </td>
          <td class="stat-col" *ngIf="selectedSort === 'total' || selectedSort === 'uy_vazifa'">
            {{ getTotal(item.student, 'uy_vazifa') }}
          </td>
          <td class="stat-col" *ngIf="selectedSort === 'total' || selectedSort === 'tasks'">
            {{ getTotal(item.student, 'tasks') }}
          </td>
          <td class="stat-col" *ngIf="selectedSort === 'total' || selectedSort === 'jarima'">
            {{ getTotal(item.student, 'jarima') }}
          </td>
          <td class="total-col" *ngIf="selectedSort === 'total'">
            <div class="xp-wrapper">
              <span class="xp-value">{{ item.totalXP }}</span>
            </div>
          </td>
          <td class="level-col">
            <div (dblclick)="onLevelDoubleClick(item.student, item.totalXP)" class="level-image-container">
              <img [src]="getLevelImage(item.level)" [alt]="item.level" class="level-image" [title]="item.level">
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Animatsiya qismi -->
  <div *ngIf="showAnimation" class="level-animation-overlay">
    <div class="level-animation-content">
      <img [src]="getLevelImage(animationLevel)" [alt]="animationLevel" class="animated-level-image">
      <h3 class="animated-student-name">{{ animationStudent?.name }}</h3>
      <h4 class="animated-level-name">{{ animationLevel }}</h4>
      
      <!-- Zarlar -->
      <div *ngFor="let particle of animationParticles" class="particle"
           [style.left]="particle.x + 'vw'"
           [style.top]="particle.y + 'vh'"
           [style.width]="particle.size + 'px'"
           [style.height]="particle.size + 'px'"
           [style.animationDuration]="particle.duration + 's'"
           [style.animationDelay]="particle.delay + 's'">
      </div>
    </div>
  </div>
</div>